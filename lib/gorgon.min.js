require("source-map-support").install(),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("lodash"),require("moment"),require("http"),require("socket.io"),require("compression"),require("express"),require("fs"),require("os"),require("sanitize-filename"),require("colog")):"function"==typeof define&&define.amd?define("gorgon",["lodash","moment","http","socket.io","compression","express","fs","os","sanitize-filename","colog"],t):"object"==typeof exports?exports.gorgon=t(require("lodash"),require("moment"),require("http"),require("socket.io"),require("compression"),require("express"),require("fs"),require("os"),require("sanitize-filename"),require("colog")):e.gorgon=t(e.lodash,e.moment,e.http,e["socket.io"],e.compression,e.express,e.fs,e.os,e["sanitize-filename"],e.colog)}(this,function(e,t,n,r,o,i,s,a,u,l){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),a=n(2),u=n(5),l=n(15),c=n(7),d=r(c),f=n(19),p=r(f);global.Logger=new l.Logger,global.Console=p["default"];var h=function(){function e(){o(this,e),this.GorgonConfig=new s.GorgonConfig,this.Logger=global.Logger,this.Logger.log("Gorgon:initServer",200,"The Gorgon has been summoned - GORGON SERVER STARTING..."),this.GorgonEnv=new a.GorgonEnv,this.GorgonContainerService=new u.GorgonContainerService,this.separator1="================================================",this.separator2="------------------------------------------------"}return i(e,[{key:"initServer",value:function(){this._bootstrap(),global.Console.log(this.separator2),global.Console.question("Loading Services"),global.Console.log(this.separator2),this.Logger.log("Gorgon:initServer",200,"The server was started successfully"),this.GorgonEnv.service.forEach(function(e){var t=48,n=this.GorgonContainerService.add(e.service);if(n){var r=6,o=t-r-e.namespace.length-2,i=d["default"].repeat(".",o);this.Logger.log("Gorgon:initServer",200,"Loaded service namespace: "+e.namespace),global.Console.log(e.namespace+" "+i+" [ "+global.Console.color("OK","green")+" ]")}else{var s=10,a=t-s-e.namespace.length-2,u=d["default"].repeat(".",a);this.Logger.log("Gorgon:initServer",400,"Failed to load service with namespace: "+e.namespace),global.Console.log(e.namespace+" "+u+" [ "+global.Console.color("FAILED","red")+" ]")}},this),this.Logger.log("Gorgon:initServer",200,"Service Loading Completed"),global.Console.log(this.separator2),global.Console.log("Server is now online...")}},{key:"_bootstrap",value:function(){global.Console.log("Gorgon Server - v"+this.GorgonConfig.data.version),global.Console.log("Author: Ryan Rentfro <rrentfro at gmail dot com>"),global.Console.log("Project: https://github.com/manufacturing-industry/gorgon"),this._motd(),global.Console.log("Press cntrl+c to exit the server")}},{key:"_motd",value:function(){global.Console.log(this.separator1),global.Console.log(this.GorgonConfig.data.motd),global.Console.log(this.separator1)}}]),e}(),v=new h;v.initServer()},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});/**
	 * Gorgon the scripting capable network server for Node JS
	 *
	 * @package Gorgon
	 * @author Ryan Rentfro
	 * @license MIT
	 * @url https://github.com/manufacturing-industry
	 */
t.GorgonConfig=function r(){n(this,r),this.data={name:"Gorgon Server",version:"0.0.1 Pre-Alpha",motd:"This is the message of the day."},this.storage={logs:"logs/"},this.load={server:!0,cli:!0,services:!0},this.debug={enable:!0}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.GorgonEnv=void 0;var i=n(3),s=r(i);t.GorgonEnv=function a(){o(this,a),this.service=new s["default"],this.service=[{sid:0,name:"Status",namespace:"StatusService",enable:!0,service:this.service}]}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(4),u=n(5),l=n(1),c=n(6),d=new c.Network,f=function(e){function t(){r(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e.config=l.StatusServiceConfig,e.name="Status Service",e.namespace="StatusService",e.description="Provides service status",e.type="Service",e.https=!0,e.inboundTypes=["rest","socket","http","webSocket","api"],e.ports=[2600,null,2680,2688,null],e.router=new a.Routes(e.namepsace),e.permissions=["internal"],e.serviceBind(),e}return i(t,e),s(t,[{key:"routes",value:function(){return{ServiceRequest:{inboundTypes:this.inboundTypes,method:"/StatusServiceRequest",callback:this.serviceRequest()}}}},{key:"serviceRequest",value:function(e,t,n){}},{key:"apiRequest",value:function(e){}},{key:"setWebSocketEvents",value:function(e){}},{key:"serviceBind",value:function(){return this.router.importRoutes(this.routes()),this._setNetworking(),d.addService(this),!0}},{key:"serviceUnbind",value:function(){d.removeService(this.namespace)}}]),t}(u.GorgonService);t["default"]=f,e.exports=t["default"]},function(e,t){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.Routes=function(){function e(t){r(this,e),this.service=t,this.inboundTypes=["rest","socket","http","https","webSocket","api"],this.routes=[],this.routeCallbacks=[],this.permissionMap=[]}return o(e,[{key:"add",value:function(e,t,n){this.routes.push(t),this.routeCallbacks(n);var r=this.routeCallbacks.length-1;e.forEach(function(e){this.inboundTypes.indexOf(e)>-1?this.permissionMap[e].push(r):console.log("ERROR - Invalid Permission Encountered in Service: ["+this.service+"] Method: ["+t+"]")})}},{key:"remove",value:function(e){var t=this.routes.indexOf(e);return t>-1&&(this.routeCallbacks[t]=null,this.routes[t]=null,this.inboundTypes.forEach(function(e){if(void 0!=this.permissionMap[e]&&this.permissionMap[e]instanceof Array){var n=this.permissionMap[e].indexOf(t);n>-1&&this.permissionMap[e].splice(n,1)}}),!0)}},{key:"importRoutes",value:function(e){if(e instanceof Array)for(var t in e)e.hasOwnProperty(t)&&this.add(e[t].inboundTypes,e[t].method,e[t].callback);return!1}},{key:"route",value:function(e,t,r){var o=this.routes.indexOf(t);if(o>-1&&void 0!=this.permissionMap[e]&&this.permissionMap[e].length>0&&this.permissionMap[e].indexOf(o)>-1){var i;return(i=this.routeCallbacks)[o].apply(i,[t,e].concat(n(r)))}return!1}}]),e}()},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.GorgonContainerService=function(){function e(){n(this,e),this.containers=[],this.containerMap=[],this.name="Gorgon Container Service",this.type="Service"}return r(e,[{key:"add",value:function(e){return null!=e.namespace&&""!=e.namespace&&this.containerMap.indexOf(e.namespace)==-1&&(this.containers.push(e),this.containerMap.push(e.namespace),!0)}},{key:"remove",value:function(e){if(this.containerMap.indexOf(e)>-1){var t=this.containerMap.indexOf(e);return this.containers.splice(t,1),this.containerMap.splice(t,1),!0}return!1}},{key:"get",value:function(e){return this.containerMap.indexOf(e)>-1&&this.containers[this.containerMap.indexOf(e)]}}]),e}(),t.GorgonService=function(){function e(){n(this,e),this.serviceId=null,this.name=null,this.description=null,this.type="Service",this.router=null,this.inboundTypes=[],this.ports=[],this.permissions=[],this.networking=[]}return r(e,[{key:"_setNetworking",value:function(){if(this.inboundTypes instanceof Array&&this.ports instanceof Array&&this.inboundTypes.length==this.ports.length)for(var e=0;e<this.inboundTypes.length;e++)this.networking.push({name:this.inboundTypes[e],port:this.ports[e]});else console.warn("GorgonService:_setNetworking - Missing or invalid networking for service "+this.name)}},{key:"setServiceId",value:function(e){return this.serviceId=e,!0}},{key:"apiRequest",value:function(e,t,n){return null}},{key:"setWebSocketEvents",value:function(e){return null}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Network=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(7),a=r(s),u=n(8),l=r(u),c=n(9),d=r(c),f=n(11),p=r(f),h=n(12),v=r(h),g=n(13),m=r(g),b=n(14),y=r(b),w=null,k=t.Network=function(){function e(){return o(this,e),w?w:(this.middleware=new l["default"],this.services=[],this.serviceMap=[],this.components=[],this.componentMap=[],this.componentTypeMap={rest:[],socket:[],webSocket:[],http:[],api:[]},this.portReservations=[],this.portReservationNamespace=[],this.activeServices=[],w=this,void 0)}return i(e,[{key:"addService",value:function(e){if(this.activeServices.indexOf(e.namespace)==-1){this.services.push(e),this.serviceMap.push(e.namespace);var t=this.serviceMap.length-1;if(e.setServiceId(e),e.networking instanceof Array){for(var n=0;n<e.networking.length;n++)this.add(t,e.namespace,e.networking[n].name,"label",e.networking[n].port);return global.Logger.log("Network:addService",200,"Added services components: "+e.name+" for Service Namespace: "+e.namespace+" - ServiceId: "+t),!0}}return!1}},{key:"removeService",value:function(e){}},{key:"add",value:function(e,t,n,r,o,i){var s=!1;if(this.portReservations.indexOf(o)==-1||null==o||void 0==o){switch(n){default:return global.Logger.log("Network:add",400,"Unable to load component type of: "+n+" for Service Namespace: "+t+" - ServiceId: "+e),!1;case"rest":s=this._createRestComponent(e,t,o,i);break;case"http":s=this._createHttpComponent(e,t,o,i);break;case"socket":break;case"webSocket":s=this._createWebSocketComponent(e,t,o,i);break;case"api":}this.componentMap.push(t+"-"+n+"-"+r+"-"+o),global.Logger.log("Network:add",200,"Added network component: "+n+" for Service Namespace: "+t+" - ServiceId: "+e)}return!1}},{key:"_createRestComponent",value:function(e,t,n,r){return this._createHttpComponent(e,t,n,r,!0)}},{key:"_createHttpComponent",value:function(e,t,n,r,o){var i=!0;void 0==o&&(o=!1);var s=(0,y["default"])();s.use((0,m["default"])({}));var u=s.all("/",function(t,n){this.middleware.callChannel("PRE_REQUEST",t),this.middleware.callChannel("PRE_RESPONSE",n),this.services[e].serviceRequest(t,n,o===!1?"http":"rest")});if(this.isPortReserved(n)){i=!1;var l=this.portReservations.indexOf(n),c=this.portReservationNamespace[l];if(c!=t)return global.Logger.log("Network:_createHttpComponent",400,"Unable to create new http component - Port Reserved by another service. Attempted to mount: "+t+" / ServiceId: "+e+" - Existing service assigned to port: "+c,{type:o===!1?"http":"rest"}),!1}return a["default"].isFunction(r)&&u.use(r),i&&u.listen(n,function(){global.Logger.log("Network:_createHttpComponent",200,"Created new http component - Mounted: "+t+" / ServiceId: "+e+" - listening on port: "+n,{type:o===!1?"http":"rest"})}),!0}},{key:"_createWebSocketComponent",value:function(e,t,n,r){var o=this,i=!0;if(this.isPortReserved(n)){i=!1;var s=this.portReservations.indexOf(n),a=this.portReservationNamespace[s];if(a!=t)return global.Logger.log("Network:_createRestComponent",400,"Unable to create component - Port Reserved by another service. Attempted to mount: "+t+" / ServiceId: "+e+" - Existing service assigned to port: "+a),!1}var u=(0,y["default"])();u.use((0,m["default"])({}));var l=p["default"].Server(u),c=new v["default"](l),d=[],f={};return c.use((0,m["default"])({})),c.on("connection",function(t){var n=t.handshake.query.userId,r={id:t.id,userId:n};findIndex(d,r.id)>-1?(console.log("[INFO] User ID is already connected, kicking."),t.disconnect()):(console.log("[INFO] User ID: "+r.userId+" connected!"),f[r.id]=t,d.push(r),c.emit("User Join",{userId:r.userId}),console.log("[INFO] Total users: "+d.length)),t.on("ding",function(){t.emit("dong")}),t.on("disconnect",function(){findIndex(d,r.id)>-1&&d.splice(findIndex(d,r.id),1),console.log("[INFO] User "+r.userId+" disconnected!"),t.broadcast.emit("userDisconnect",{userId:r.userId})}),o.services[e].setWebSocketEvents(t)}),l.listen(n,function(){console.log("[INFO] "+t+" Listening on *:"+n)}),!0}},{key:"_createSocketComponent",value:function(e,t){}},{key:"_createApiComponent",value:function(e,t){return d["default"].addApiNode(e,t,this.services[e].apiRequest)}},{key:"remove",value:function(e,t,n){}},{key:"isPortReserved",value:function(e){return this.portReservations.indexOf(e)>-1}}]),e}(),S=(function(){function e(t,n,r,i){o(this,e),this.type=t,this.label=n,this.port=r,this.service=i,this.attr={}}return i(e,[{key:"addAttribute",value:function(e,t){this.attr[e]=t}},{key:"removeAttribute",value:function(e){delete this.attr[e]}}]),e}(),new k);t["default"]=S},function(e,t){e.exports=require("lodash")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Middleware=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(7),a=r(s),u=t.Middleware=function(){function e(){o(this,e),this.data=[],this.serviceRegister=[],this.dataMap=[],this.channels=["PRE_REQUEST","PRE_RESPONSE","PRE_API_CALL","POST_API_CALL"],this.channels.forEach(function(e){this.data.push([]),this.dataMap.push(e)},this)}return i(e,[{key:"addMiddleware",value:function(e,t,n,r){var o=this._getChannelId(e);if(o>-1){var i=this._getExistingMiddleware(e[o],t,i,r);if(i===!1)return this.channels[o].push({service:t,middleware:i,method:r}),global.Logger.log("Middleware:addMiddleware",200,"A new middleware was added for Service Namespace: "+t+" on Channel: "+e),!0;global.Logger.log("Middleware:addMiddleware",300,"Attempted to add duplicate middleware for Service Namespace: "+t+" on Channel: "+e+" for middleware: "+i+" with method: "+r)}global.Logger.log("Middleware:addMiddleware",400,"Attempted to add a middleware for non-existent channel: "+e+" - for Service Namespace: "+t)}},{key:"removeMiddleware",value:function(e,t,n){this._getChannelId(e)}},{key:"callChannel",value:function(e,t){var n=this._getChannelId(e);if(n>-1){var r=this.channels[n];r instanceof Array&&r.foreach(function(e){t=e.method(t)})}else global.Logger.log("Middleware:callChannel",400,"Attempted to call a non-existent channel: "+e+" - for Service Namespace: "+serviceNamespace);return t}},{key:"_getExistingMiddleware",value:function(e,t,n){var r=a["default"].find(e,{serviceNamespace:t,middleware:n});return void 0==r&&r}},{key:"_getChannelId",value:function(e){return this.channels.indexOf(e.toUpper)}}]),e}();t["default"]=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Api=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(7),a=(r(s),n(10)),u=r(a),l=n(8),c=r(l),d=null,f=(t.Api=function(){function e(){return o(this,e),d?d:(this.middleware=new c["default"],this.api=[],this.apiMap=[],this.serviceIdMap=[],d=this,void 0)}return i(e,[{key:"addApiNode",value:function(e,t,n){return this._getNodePos(t)===!1?(this.api.push(n),this.apiMap.push(t),this.serviceIdMap.push(e),global.Logger.log("Api:addApiNode",200,"Added a new API node for Service Namespace: "+t),!0):(global.Logger.log("Api:addApiNode",400,"Unable to create new api node. A node by for this service namespace already exists - Service Namespace: "+t),!1)}},{key:"getApiNode",value:function(e){var t=this._getNodePos(e);return t>-1&&this.api[t]}},{key:"_getNodePos",value:function(e){var t=this.apiMap.indexOf(e);return t!=-1&&this.apiMap[t]}},{key:"callApiNode",value:function(e,t,n){if(node=this.getApiNode(e),node!==!1){var r=new f(t,n);return this.middleware.callChannel("PRE_API_CALL",r),n=r.callApi(node,mehod),this.middleware.callChannel("POST_API_CALL",n),n.returned=(0,u["default"])(),n}return this.Logger.log("Api:callApiNode",400,"Failed to call node service with namespace: "+e+" - no api node exists for this namespace."),!1}}]),e}(),function(){function e(t,n){o(this,e),this.method=t,this.error=!1,this.errors=[],this.data=n,this.created=(0,u["default"])(),this.updated=null,this.returned=null}return i(e,[{key:"callApi",value:function(e){return e(this),this.updated=(0,u["default"])(),this}}]),e}())},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("express")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(16),u=o(a),l=n(10),c=r(l),d=n(17),f=o(d),p=n(1),h=n(18),v=r(h),g=(t.Logger=function(){function e(){i(this,e),this.fs=u,this.GorgonConfig=new p.GorgonConfig,this.sanitize=v["default"],this.topicMap=[],this.subscribers=[],this.subscriberMap=[],this.level=["Debug","Info","Warn","Error","Critical","Fatal"],this.levelKey=[100,200,300,400,500,600]}return s(e,[{key:"log",value:function(e,t,n,r,o){var i=new g(e,t,n,r,o),s=null==i.values||void 0==i.values?null:JSON.stringify(i.values),a=i.created.format("YYYYMMDD")+".log";switch(i.type){default:a=this.sanitize(i.type)+"-"+a;break;case void 0:case!0:case"sys":a="sys-"+a;break;case"error":a="error-"+a}var l=i.created.format()+" "+i.level+" "+i.location+" [message="+i.message+"] [values="+s+"]"+f.EOL;return this.fs.existsSync(this.GorgonConfig.storage.logs)||u.mkdirSync(this.GorgonConfig.storage.logs),this.fs.appendFile(this.GorgonConfig.storage.logs+a,l,"utf8",function(e){if(e)return console.error(e),!1}),!0}}]),e}(),function m(e,t,n,r,o){i(this,m),this.location=e,this.level=null==t||void 0==t?100:t,this.message=n,this.type=null==o||void 0==o?"sys":o,this.values=null==r||void 0==r?null:r,this.created=(0,c["default"])()})},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("sanitize-filename")},function(e,t){e.exports=require("colog")}])});
//# sourceMappingURL=gorgon.min.js.map